<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt Vé Máy Bay</title>
    <link rel="stylesheet" href="booking styles.css">
</head>
<body>
    <div class="container">
        <h1 class="title">Đặt Vé Máy Bay</h1>
        
        <div class="card" id="flight-booking-section">
            <h2>Thông tin chuyến bay</h2>
            <input type="text" placeholder="Điểm đi" id="departure">
            <input type="text" placeholder="Điểm đến" id="destination">
            <input type="date" placeholder="Ngày đi" id="departure-date">
            <input type="date" placeholder="Ngày về (nếu có)" id="return-date">
            <select id="passenger-count" title="Số hành khách">
                <option value="1">1 hành khách</option>
                <option value="2">2 hành khách</option>
                <option value="3">3 hành khách</option>
                <option value="4">4 hành khách</option>
            </select>
            <button onclick="bookFlight()">Tìm chuyến bay</button>
        </div>
        
        <p><a href="#" onclick="navigateHome()">Quay lại trang chủ</a> | <a href="hotel_booking.html">Đặt khách sạn</a></p>
    </div>
    
    <script>
        // Check login status and handle navigation
        function navigateHome() {
            const userToken = localStorage.getItem('userToken');
            if (userToken) {
                window.location.href = 'Home page.HTML';
            } else {
                window.location.href = 'index.html';
            }
        }

        // Check login status when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const userToken = localStorage.getItem('userToken');
            if (!userToken) {
                window.location.href = 'login.html';
            }
        });

        async function bookFlight() {
    let departure = document.getElementById('departure').value;
    let destination = document.getElementById('destination').value;
    let departureDate = document.getElementById('departure-date').value;
    let passengers = document.getElementById('passenger-count').value;

    if (!departure || !destination || !departureDate) {
        alert("Vui lòng nhập đầy đủ thông tin chuyến bay.");
        return;
    }

    try {
        const response = await fetch(`http://localhost:5000/api/flights/search?departure=${departure}&arrival=${destination}&date=${departureDate}`)

;
        const flights = await response.json();

        if (flights.length === 0) {
            alert("Không tìm thấy chuyến bay phù hợp.");
             // return statement to exit the function
            return;
        }

        const flight = flights[0];
        alert(`Tìm thấy chuyến bay: ${flight._id}, giá: ${flight.price}, giờ khởi hành: ${new Date(flight.departure.time).toLocaleString()}`);
        
        // Tùy bạn: có thể mở form đặt vé, hoặc chuyển trang tiếp theo tại đây

    } catch (error) {
        console.error('Lỗi khi tìm chuyến bay:', error);
        alert("Đã xảy ra lỗi khi tìm chuyến bay.");
    }
}

    </script>
</body>
</html>
